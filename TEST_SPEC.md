# アウトライナー 包括的テスト仕様書

## 1. 基本編集・構造操作テスト (Basic Editing & Structure)

基本的なテキスト入力と、アウトライナーの核となる階層構造の操作を確認します。

| ID | テスト項目 | 手順 | 期待される動作 |
|:---|:---|:---|:---|
| **B-01** | テキスト入力 | 任意の文字を入力する | キャレット位置に文字が入力されること。 |
| **B-02** | 改行 (Enter) | 行の途中で `Enter` を押下 | インデントレベルを保ったまま改行され、キャレット以降のテキストが次行へ移動すること。 |
| **B-03** | 削除による行結合 | 行頭で `Backspace` を押下 | 前の行の末尾に現在の行が結合されること。 |
| **B-04** | インデント (Tab) | 行頭または行中で `Tab` を押下 | 行のインデントレベルが1つ上がること。 |
| **B-05** | デインデント (Shift+Tab) | 行頭または行中で `Shift+Tab` を押下 | 行のインデントレベルが1つ下がること。 |
| **B-06** | 行頭スペースによるインデント | 行頭で `Space` (半角/全角) を押下 | `Tab` と同様にインデントレベルが上がること。 |
| **B-07** | 行頭BSによるデインデント | 行頭で `Backspace` を押下 (インデント>0の場合) | インデントレベルが下がること (行結合せず)。 |
| **B-08** | 飛び級インデント | レベル0の次の行をレベル2にする | エラーにならず、インデントの深さが1の次に3が来るような構造が許容されること。 |
| **B-09** | インデント構造の視覚化 | 階層を作成する | バレット等の表示により、階層構造が視覚的に判別できること。 |

## 2. 折りたたみ機能テスト (Folding)

階層の表示・非表示を制御する機能を確認します。

| ID | テスト項目 | 手順 | 期待される動作 |
|:---|:---|:---|:---|
| **F-01** | 折りたたみボタンの表示 | 子要素を持つ行の行番号付近をホバー | 折りたたみボタン（▼）が表示されること。 |
| **F-02** | マウス操作での折りたたみ | ▼ボタンをクリック | 子要素が非表示になり、アイコンが右向き三角（▶）に変わること。 |
| **F-03** | マウス操作での展開 | ▶ボタンをクリック | 子要素が表示され、アイコンが下向き三角（▼）に変わること。 |
| **F-04** | ショートカット折りたたみ | `Ctrl+Enter` を押下 | 現在行の子要素が折りたたまれる/展開されること。 |
| **F-05** | 全階層一括折りたたみ | 親行で一括折りたたみを実行 | 配下の全階層（孫含む）が折りたたまれた状態になること。 |
| **F-06** | 全行操作 (Ctrl+Shift+A) | `Ctrl+Shift+A` を押下 | ドキュメント全体のすべての行が折りたたまれる/展開されること。 |
| **F-07** | 階層指定表示 (Ctrl+Num) | `Ctrl+2` 等を押下 | 指定した階層（例: レベル2）より深い行が全て折りたたまれ、浅い行のみ表示されること。 |

## 3. 行の移動・操作テスト (Row Manipulation)

行の順序変更や複製機能を確認します。

| ID | テスト項目 | 手順 | 期待される動作 |
|:---|:---|:---|:---|
| **M-01** | 行移動 (Ctrl+Up/Down) | `Ctrl+Up` / `Ctrl+Down` を押下 | 行が上下に入れ替わること。 |
| **M-02** | 構造移動 (Alt+Up/Down) | 子要素を持つ行で `Alt+Up` / `Alt+Down` | 子要素を連れたまま（構造を維持して）兄弟要素間で移動すること。 |
| **M-03** | インデント移動 (Ctrl+Left/Right)| `Ctrl+Right` / `Ctrl+Left` を押下 | インデントレベルが変更されること（Tab操作と同等）。 |
| **M-04** | 行複製 (Shift+Alt+Up/Down)| `Shift+Alt+Up` / `Shift+Alt+Down` を押下 | 現在行（選択範囲）が上下に複製されること。 |
| **M-05** | レベル0改行 (Shift+Enter)| 深い階層で `Shift+Enter` を押下 | インデントレベル0の新しい行が挿入されること。 |

## 4. 記法・装飾テスト (Notation & Formatting)

独自の記法によるレンダリングと挙動を確認します。

| ID | テスト項目 | 手順 | 期待される動作 |
|:---|:---|:---|:---|
| **N-01** | 太字 | `[* text]` と入力 | **text** (太字) として表示されること。 |
| **N-02** | 斜体 | `[/ text]` と入力 | *text* (斜体) として表示されること。 |
| **N-03** | 打ち消し線 | `[- text]` と入力 | ~~text~~ (打ち消し線) として表示されること。 |
| **N-04** | 下線 | `[_ text]` と入力 | <u>text</u> (下線) として表示されること。 |
| **N-05** | 配置 (中央/右) | `[\| text]`, `[> text]` | テキストが中央寄せ/右寄せになること。 |
| **N-06** | 見出し (H1-H6) | `[# text]` ～ `[###### text]` | それぞれ適切なサイズの見出しとして表示されること。 |
| **N-07** | インライン引用 | `[" text]` | インライン引用表示になること。 |
| **N-08** | 引用ブロック | 行頭 `>` で入力 | 引用ブロックとして表示されること。 |
| **N-09** | チェックボックス (未/済) | `[ ]`, `[x]` | 未チェック/チェック済みのボックスが表示されること。クリックでトグルすること。 |
| **N-10** | インラインコード | `` `text` `` | コードハイライト表示になること。 |
| **N-11** | タグ | `#tag` | タグとして認識され、入力時に自動補完候補が出ること。 |

## 5. リンク・メディア機能テスト (Links & Media)

URL、画像、動画、内部リンクの挙動を確認します。

| ID | テスト項目 | 手順 | 期待される動作 |
|:---|:---|:---|:---|
| **L-01** | 生URLリンク | `https://...` を入力 | リンクになり、クリックで開くこと。 |
| **L-02** | URL記法 | `[url]` または `[url text]` または `[text url]` | リンクになり、`text`を指定した場合は表示が変わること。 |
| **L-03** | 相対リンク (フォーカス時) | `[page]` の行にカーソルを置く | 生のテキスト `[page]` として編集可能であること。 |
| **L-04** | 相対リンク (非フォーカス時)| `[page]` の行からカーソルを外す | ハイパーリンクとしてレンダリングされ、クリックで `./page` へ遷移すること。 |
| **L-05** | リンク自動補完 | `[` を入力し文字を打つ | 既存ページ等のリンク補完候補が表示されること。 |
| **L-06** | 画像表示 | `[imageurl]` `[imageurl text]` `[text imageurl]` | 画像がインラインで表示されること。 |
| **L-07** | 画像拡大 | 表示された画像をクリック | 拡大表示（モーダル等）されること。 |
| **L-08** | YouTube埋め込み | `[youtubeurl]` | 動画プレーヤーが埋め込まれ、再生可能であること。 |

## 6. ブロック機能テスト (Blocks)

複数行にわたる特殊ブロックのレンダリングを確認します。

| ID | テスト項目 | 手順 | 期待される動作 |
|:---|:---|:---|:---|
| **BK-01** | コードブロック | `[```lang ... ```]` | 指定言語でシンタックスハイライトされ、ブロック表示されること。 |
| **BK-02** | テーブルブロック | `[table name ... ]` | パイプ(`\|`)区切りが表形式にレンダリングされること。 |
| **BK-03** | LaTeX数式 (インライン) | `[$ E=mc^2]` | 数式としてレンダリングされ、編集時はプレビューが表示されること。 |
| **BK-04** | LaTeX数式 (ブロック) | `[$$ ... $$]` | ディスプレイ数式モードでレンダリングされること。 |

## 7. 入力補助・ショートカットテスト (Input Assistance & Shortcuts)

エディタとしての利便性機能を確認します。

| ID | テスト項目 | 手順 | 期待される動作 |
|:---|:---|:---|:---|
| **A-01** | 括弧の自動補完 | `(`, `{`, `"`, `「`, `[` を入力 | 対応する閉じ括弧が自動入力され、キャレットが間に配置されること (例: `(|)` )。 |
| **A-02** | Undo/Redo | 入力 -> `Ctrl+Z` -> `Ctrl+Shift+Z` | 入力が取り消され、その後やり直されること。Undo-tree方式であるか確認。 |
| **A-03** | カーソル移動 (基本) | 矢印キー, Home, End | 指定通りにカーソルが移動すること。 |
| **A-04** | カーソル移動 (修飾キー) | `Ctrl+Home/End`, `PgUp/PgDn` | 文頭・文末、画面単位の移動ができること。 |
| **A-05** | 範囲選択 | `Shift+矢印`, `Ctrl+Shift+矢印` | 文字単位、単語単位での範囲選択ができること。 |
| **A-06** | 全選択 | `Ctrl+A` | テキスト全体が選択されること。 |
| **A-07** | 検索 | `Ctrl+F` -> 文字入力 -> `Esc` | 検索窓が開き検索でき、Escで閉じられること。 |
| **A-08** | コマンドパレット | `Ctrl+Shift+P` | 全コマンドの検索・実行ウィンドウが開くこと。 |
| **A-09** | クリップボード操作 | `Ctrl+C`, `Ctrl+X`, `Ctrl+V` | コピー、切り取り、貼り付けが正常に動作すること。 |
| **A-10** | 複数行インデント操作 | 複数行選択 -> `Tab` / `Ctrl+Right` | 選択された複数行のインデントレベルが一括で変わること。 |
| **A-11** | ノード間移動 | `Alt+Left` / `Alt+Right` | 親ノードへ移動 / 最初の子ノードへ移動すること。 |

## 8. エッジケース・複合テスト (Edge Cases)

### 8.1. 構造とインデントの境界値 (Structure Boundaries)

階層構造の整合性が崩れやすいパターンを検証します。

| ID | テスト項目 | 手順 | 期待される動作 |
|:---|:---|:---|:---|
| **E-101** | 孤立した深いインデント | レベル0の行の直後に、レベル5の行を作成（Tab連打等） | エラーにならず、インデントレベル5として保持・表示されること。 |
| **E-102** | 親消失時の子要素の挙動 | 親行（子要素あり）の行頭で `Backspace` を押し、上の行（子要素なし）と結合する | 元の親行の内容が上の行の末尾に結合され、子要素たちは「結合された新しい親」の子として正しく引き継がれること。 |
| **E-103** | ルート要素の移動限界 | 文書の先頭行（レベル0）で `Alt+Up` / 末尾行で `Alt+Down` | 何も起こらないこと（クラッシュやループが発生しない）。 |
| **E-104** | 最深階層での作成 | 非常に深い階層（例: レベル50以上）を作成する | 表示崩れやパフォーマンス低下が許容範囲内であること。 |
| **E-105** | 空行のインデント操作 | 文字のない空行で `Space` (IME on/off) / `Tab` / `Shift+Tab` | 文字入力と同様にインデントレベルだけが変更されること。 |

### 8.2. 折りたたみと編集の競合 (Folding Interactions)

「見えていないもの」に対する操作が、データ破壊につながらないか検証します。

| ID | テスト項目 | 手順 | 期待される動作 |
|:---|:---|:---|:---|
| **E-201** | 折りたたみ中の親削除 | 子要素を折りたたんでいる親行を選択し、`Ctrl+X` (切り取り) / `Backspace` / `Delete` | 親行が切り取られ、**非表示の子要素すべて**は上の行の子になること。 |
| **E-202** | 折りたたみ中の切り取り | 親要素と折りたたまれている子要素すべてを選択し、 `Ctrl+X` (切り取り) | 親要素と子要素すべてがクリップボードに保存され、削除する。 |
| **E-203** | 折りたたみ中のペースト | E-202で切り取った内容を別の場所にペースト | 親要素と子要素（階層構造維持）がすべて復元されること。展開状態はリセットまたは維持（実装依存だがデータ損失なきこと）。 |
| **E-204** | 折りたたみ中の検索 | 折りたたまれた子要素内のテキストを `Ctrl+F` で検索 | ヒットした場合、自動的に親要素が展開され、該当箇所にジャンプ・ハイライトされること。 |
| **E-205** | 折りたたみ直後への入力 | 折りたたまれた親行の**行末**で文字入力 | 入力が親行に反映され、折りたたみは展開されないこと。 |
| **E-206** | 折りたたみ行の改行 | 折りたたまれた親行の**行末**で`Enter` | 親行の兄弟として新しい空行が作成され、折りたたみ状態は維持されること。 |
| **E-207** | 全選択と削除 | すべて折りたたんだ状態で `Ctrl+A` -> `Delete` | 見えている親だけでなく、隠れている子要素も含めて文書全体が削除されること。 |

### 8.3. 記法のネスト・破損 (Notation Complexity)

パーサー（解析機）が誤作動しやすい記法の組み合わせを検証します。

| ID | テスト項目 | 手順 | 期待される動作 |
|:---|:---|:---|:---|
| **E-301** | 記法のネスト（太字・斜体） | `[* 太字の中に [/ 斜体] を入れる]` | **太字の中に *斜体* を入れる** と正しくレンダリングされること。 |
| **E-302** | リンク記法内の装飾 | `[url [* 太字リンクテキスト]]` | リンクテキスト部分が太字かつリンクとして機能すること。 |
| **E-303** | 壊れた閉じ括弧 | `[# 見出しの閉じ忘れ` （`]`がない） | その行が見出しとして認識される、または平文として表示されること（エディタがフリーズしないこと）。 |
| **E-304** | 記号のエスケープ的入力 | コードブロック外で `[` や `*` を大量に連続入力 | 誤って記法として誤認識されず、入力通り表示されるか、記法ルール通り処理されること。 |
| **E-305** | コードブロック内の記法 | コードブロックの中に `[# 見出し]` や `[url]` を記述 | 解析されず、そのままの文字列（ソースコード）として表示されること。 |
| **E-306** | 存在しない画像URL | `[broken_image_url.jpg]` | リンク切れアイコン、または代替テキストが表示され、アプリがクラッシュしないこと。 |
| **E-307** | 数式の構文エラー | `[$ \invalid syntax { ]` | エラーメッセージが表示される、または赤字になる等で、エディタ全体が落ちないこと。 |

### 8.4. 日本語入力 (IME) 関連 (IME & Multibyte)

ショートカットキーとIMEの確定操作の衝突を検証します。

| ID | テスト項目 | 手順 | 期待される動作 |
|:---|:---|:---|:---|
| **E-401** | IME変換中のEnter | 文字入力中（未確定状態）に `Enter` を押下 | **改行されず**、文字が確定されること。 |
| **E-402** | IME変換中のショートカット | 文字入力中（未確定状態）に `Ctrl+Z` や `Tab` | 操作が無効化される。 |
| **E-403** | 全角スペースのインデント | 行頭で全角スペースを入力 | 仕様通り `Space` として扱われ、インデントレベルが上がること。 |
| **E-404** | 括弧補完とIME | IME ON状態で `「` を入力 | `「|」` と補完され、キャレットが間にあり、かつIME入力状態が維持されていることが望ましい。 |

### 8.5. 選択範囲とクリップボード (Selection & Clipboard)

矩形選択や不完全な選択状態での挙動を検証します。

| ID | テスト項目 | 手順 | 期待される動作 |
|:---|:---|:---|:---|
| **E-501** | 複数階層のインデント一括変更 | レベル1, レベル2, レベル1 の3行を選択し `Tab` | 全行がそれぞれ レベル2, 3, 2 にシフトすること。 |
| **E-502** | 複数階層のインデント一括変更 | レベル1, レベル2, レベル1 の3行を選択し `Shift+Tab` | 全行がそれぞれ レベル0, 1, 0 にシフトすること。 |
| **E-503** | 記法の一部だけ選択して装飾 | `[* bold]` の `old]` 部分だけ選択して `/` (斜体) | 既存の記法が壊れても、新たな記法タグが挿入されること（例: `[* b[/ old]]]` ）。 |
| **E-504** | 外部からのペースト | ブラウザ等からリッチテキストをペースト | 可能な限りプレーンテキスト、またはMarkdown的に解釈されてペーストされること（制御文字で壊れないこと）。 |
| **E-505** | ブロックをまたぐ選択 | コードブロックの開始行から終了行の外まで選択して削除 | ブロック構造が解除され、残ったテキストが正常な平文として残ること。 |

### 8.6. Undo/Redo (Undo Tree)

単純なスタックではなく「Undo Tree」方式であることの挙動検証です。

| ID | テスト項目 | 手順 | 期待される動作 |
|:---|:---|:---|:---|
| **E-601** | 分岐の作成 | 1. "A"と入力<br>2. Undo (空になる)<br>3. "B"と入力 | "A"の状態が失われず、履歴の別ブランチとして保持されていること（実装されたUIまたはショートカットで到達可能か確認）。 |
| **E-602** | 構造変更のUndo | `Alt+Up` で行を移動させた直後に `Ctrl+Z` | 行の移動が取り消され、元の位置に戻ること。 |
| **E-603** | 範囲削除のUndo | `Ctrl+A` -> `Delete` (全削除) した直後に `Ctrl+Z` | 全てのテキストと**階層構造**が完全に元通りになること。 |

### 8.7. 自動補完とトリガー (Auto-completion)

| ID | テスト項目 | 手順 | 期待される動作 |
|:---|:---|:---|:---|
| **E-701** | 補完のキャンセル | `[` を入力して候補が出ている状態で `Esc` または `Space` | 補完ウィンドウが閉じ、入力した文字(`[|]`)がそのまま残ること。 |
| **E-702** | リンク自動補完の絞り込み | `[` の後に存在しないページ名を入力 | 候補が消えること。 |
| **E-703** | 連続する補完文字 | `((` や `[[` と入力 | 1つ目で `(|)`, 2つ目で `((|))` のように正しくネストされて補完されること。 |

### 8.8. 巨大データ・パフォーマンステスト (Performance & Limits)

| ID | テスト項目 | 手順 | 期待される動作 |
|:---|:---|:---|:---|
| **E-801** | 長文ペースト | 1万文字程度のテキストを1行にペースト | エディタがフリーズせず、編集可能なこと。 |
| **E-802** | 大量行作成 | 5000行程度のリストを作成 | スクロールや折りたたみ操作が滑らかに行えること。 |
| **E-803** | 高速入力 | キーボードをランダムに高速連打 | アプリケーションがクラッシュしないこと。 |

Cargo testによるAPIレベルのテストに加え、
PlaywrightやCypress等のE2Eテストフレームワークを用いて、上記のテストケースを自動化することを推奨します。
